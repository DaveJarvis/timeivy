var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var e=function(){};e.prototype=a;return new e};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},e={};try{return e.__proto__=a,e.a}catch(b){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,e){a.__proto__=e;if(a.__proto__!==e)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,e){a.prototype=$jscomp.objectCreate(e.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var b=$jscomp.setPrototypeOf;b(a,e)}else for(b in e)if("prototype"!=b)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(e,b);d&&Object.defineProperty(a,b,d)}else a[b]=e[b];a.superClass_=e.prototype};
$jscomp.findInternal=function(a,e,b){a instanceof String&&(a=String(a));for(var d=a.length,h=0;h<d;h++){var f=a[h];if(e.call(b,f,h,a))return{i:h,v:f}}return{i:-1,v:void 0}};$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,b){a!=Array.prototype&&a!=Object.prototype&&(a[e]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,e,b,d){if(e){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var h=a[d];h in b||(b[h]={});b=b[h]}a=a[a.length-1];d=b[a];e=e(d);e!=d&&null!=e&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var e=0;return $jscomp.iteratorPrototype(function(){return e<a.length?{done:!1,value:a[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,e){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,d={next:function(){if(b<a.length){var h=b++;return{value:e(h,a[h]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");Object.equals=function(a,e){if(!(a instanceof Object&&e instanceof Object))return!1;for(var b in a)if(a.hasOwnProperty(b)&&(!e.hasOwnProperty(b)||a[b]!==e[b]&&!Object.equals(a[b],e[b])))return!1;return!0};Object.defineProperty(Object.prototype,"encode",{value:function(){return encodeURIComponent(JSON.stringify(this))}});
Object.defineProperty(Object.prototype,"decode",{value:function(){return JSON.parse(decodeURIComponent(this))}});Array.prototype.peek=function(){return this[this.length-1]};Date.prototype.isWeekend=function(){var a=this.getDay();return 0==a||6==a};String.prototype.padLeft=function(a){return String(a+this).slice(-a.length)};
String.prototype.toTime=function(){var a=this,e=!1,b=!1,d=0,h=0;null!=a?(e=null!==a.match(/p/i),b=null!==a.match(/a/i),a=a.replace(/^00/,"24"),a=parseInt(a.replace(/\D/g,""),10)):a=0;0<a&&24>a?d=a:100<=a&&2359>=a?(d=~~(a/100),h=a%100):2400<=a&&(h=a%100,e=!1);12==d&&!1===b?e=!0:12<d&&(e=!0,d-=12);59<h&&(h=59);return(""+d).padLeft("00")+":"+(""+h).padLeft("00")+" "+(e?"PM":"AM")};Storage.prototype.put=function(a,e){this.setItem(a,LZString.compressToUTF16(e.encode()))};
Storage.prototype.get=function(a,e){a=this.getItem(a);return null===a?e:LZString.decompressFromUTF16(a).decode()};(function(a,e,b,d){function h(c,b){this.element=c;this.settings=a.extend({},f,b);this.settings.ivy=this;this._defaults=f;this._name="ivy";this._cell=[0,0];this._$cellInput=!1;this._commandExecutor=new k;this.init()}var f={classCellActive:"ivy-active",classCellActiveInput:"ivy-editor",classCellTransient:"ivy-transient",classCellReadOnly:"ivy-readonly",maxPageSize:30,dispatchKeysNavigate:[{k:"enter",f:"navigateDown"},{k:"up",f:"navigateUp"},{k:"down",f:"navigateDown"},{k:"left",f:"navigateLeft"},{k:"right",
f:"navigateRight"},{k:"ctrl+up",f:"navigateUpSkip"},{k:"ctrl+down",f:"navigateDownSkip"},{k:"ctrl+left",f:"navigateLeftSkip"},{k:"ctrl+right",f:"navigateRightSkip"},{k:"pageup",f:"navigatePageUp"},{k:"pagedown",f:"navigatePageDown"},{k:"home",f:"navigateRowHome"},{k:"end",f:"navigateRowEnd"},{k:"ctrl+home",f:"navigateHome"},{k:"ctrl+end",f:"navigateEnd"},{k:"shift+tab",f:"navigateLeft"},{k:"tab",f:"navigateRight"},{k:"f2",f:"editStart"},{k:"ctrl+x",f:"editCut"},{k:"ctrl+c",f:"editCopy"},{k:"ctrl+ins",
f:"editCopy"},{k:"del",f:"editErase"},{k:"shift+del",f:"editDeleteRow"},{k:"ins",f:"editDuplicateRow"},{k:"ctrl+i",f:"editDuplicateRow"},{k:"command+i",f:"editDuplicateRow"},{k:"shift+space",f:"editAppendRow"},{k:"ctrl+z",f:"editUndo"},{k:"command+z",f:"editUndo"},{k:"ctrl+shift+z",f:"editRedo"},{k:"ctrl+y",f:"editRedo"},{k:"command+y",f:"editRedo"}],dispatchKeysEdit:[{k:"up",f:"navigateUp"},{k:"down",f:"navigateDown"},{k:"shift+tab",f:"navigateLeft"},{k:"tab",f:"navigateRight"},{k:"enter",f:"editAccept"},
{k:"esc",f:"editCancel"}],init:function(){},refreshCells:function(){},onCellValueChangeBefore:function(c,a,b){return c},onCellValueChangeAfter:function(c,a){},onRowDuplicateAfter:function(c){},onRowInsertAfter:function(c,a){},onRowAppendAfter:function(c,a){},onRowDeleteAfter:function(c){}};a.extend(h.prototype,{init:function(){this.settings.init();this.setup();this.bindNavigateMode();this.bindPrintableKeys();this.bindNavigationClicks();this.bindPasteHandler();this.activate()},refreshCells:function(){this.settings.refreshCells()},
setup:function(){Mousetrap.prototype.stopCallback=function(c,a,b){c.preventDefault();return!1}},navigateTableCell:function(c){var a=c.parent().children().index(c);c=c.parent().parent().children().index(c.parent());!1===this.isActiveCell(c,a)&&this.navigate(c,a)},bindNavigationClicks:function(){var c=this,b=a(c.getTableBodyElement());b.on("click","td",function(){c.navigateTableCell(a(this))});b.on("dblclick doubletap","td",function(){c.navigateTableCell(a(this));c.editStart()})},bindPrintableKeys:function(){var c=
this;a(c.getTableBodyElement()).on("keypress",function(a){var b="number"===typeof a.which?a.which:a.keyCode;"keypress"!==a.type||!b||a.ctrlKey||a.metaKey||(c.editStart(String.fromCharCode(b)),a.stopPropagation(),a.preventDefault())})},unbindPrintableKeys:function(){a(this.getTableBodyElement()).off("keypress")},_bindDispatchKeys:function(c){Mousetrap.reset();for(var a=this,b={},d=0;d<c.length;b={f:b.f},d++){var g=c[d].k;b.f=c[d].f;Mousetrap.bind(g,function(c){return function(b){a[c.f]()}}(b))}},bindNavigateMode:function(){this._bindDispatchKeys(this.settings.dispatchKeysNavigate)},
bindEditMode:function(){this._bindDispatchKeys(this.settings.dispatchKeysEdit)},bindPasteHandler:function(){var c=this;a(b).on("paste",function(a){if(a.originalEvent){var b=a.originalEvent.clipboardData.getData("text");c.cellUpdate(b);a.stopPropagation();a.preventDefault()}})},_sanitizeCellIndex:function(c,a){return c>a?a:0>c?0:c},getTableBodyElement:function(){return a(this.element)[0]},getCellRow:function(){return this._cell[0]},getCellCol:function(){return this._cell[1]},setCellRow:function(c){this._cell[0]=
this._sanitizeCellIndex(c,this.getMaxRows())},setCellCol:function(c){this._cell[1]=this._sanitizeCellIndex(c,this.getMaxCols())},getCell:function(c,a){return this.getTableBodyElement().rows[c].cells[a]},getCellLastRow:function(c){var a=this.getMaxRows();return this.getCell(a,c)},getActiveCell:function(){var c=this.getCellRow(),a=this.getCellCol();return this.getCell(c,a)},getMaxRows:function(){return this.getTableBodyElement().rows.length-1},getMaxCols:function(){return this.getTableBodyElement().rows[0].cells.length-
1},getRowCount:function(){return this.getTableBodyElement().rows.length},isActive:function(){return 0<this.getTableBodyElement().rows.length},isActiveCell:function(c,a){return this.isActiveCellRow(c)&&this.isActiveCellCol(a)},isActiveCellRow:function(c){return c===this.getCellRow()},isActiveCellCol:function(c){return c===this.getCellCol()},isActiveCellProtected:function(){var c=a(this.getActiveCell());return c.hasClass(this.settings.classCellReadOnly)||c.hasClass(this.settings.classCellTransient)},
activate:function(){this.setCellRow(this.getCellRow());this.setCellCol(this.getCellCol());a(this.getActiveCell()).addClass(this.settings.classCellActive)},deactivate:function(){a(this.getActiveCell()).removeClass(this.settings.classCellActive)},cellStateRetrieve:function(){var c=a(this.getActiveCell());return{cellRow:this.getCellRow(),cellCol:this.getCellCol(),cellValue:c.text()}},cellStateRestore:function(c){this._navigate(c.cellRow,c.cellCol);this.setActiveCellValue(c.cellValue)},getCommandExecutor:function(){return this._commandExecutor},
execute:function(c){this.getCommandExecutor().execute(c)},focus:function(){a(this.getTableBodyElement()).focus()},_navigate:function(c,a){this.deactivate();this.setCellRow(c);this.setCellCol(a);this.activate();this.focus()},navigate:function(c,a){this.editStop();this.execute(new n(this,c,a))},navigateRow:function(c){this.navigate(this.getCellRow()+c,this.getCellCol())},navigateCol:function(c){this.navigate(this.getCellRow(),this.getCellCol()+c)},navigatePageUp:function(){this.navigateRow(-this.settings.maxPageSize)},
navigatePageDown:function(){this.navigateRow(+this.settings.maxPageSize)},navigateUp:function(){this.navigateRow(-1)},navigateDown:function(){this.navigateRow(1)},navigateLeft:function(){this.navigateCol(-1)},navigateRight:function(){this.navigateCol(1)},navigateUpSkip:function(){console.log("Navigate up skip");this.navigateRow(-1)},navigateDownSkip:function(){console.log("Navigate down skip");this.navigateRow(1)},navigateLeftSkip:function(){console.log("Navigate left skip");this.navigateCol(-1)},
navigateRightSkip:function(){console.log("Navigate right skip");this.navigateCol(1)},navigateHome:function(){this.navigate(0,0)},navigateEnd:function(){this.navigate(1E3,1E3)},navigateRowHome:function(){this.navigateCol(-1E3)},navigateRowEnd:function(){this.navigateCol(1E3)},editCut:function(){this.execute(new p(this))},editCopy:function(){var c=a("<input>"),d=a(this.getActiveCell());a("body").append(c);c.val(d.text()).select();b.execCommand("copy");c.remove()},editErase:function(){this.cellUpdate("")},
cellUpdate:function(c){this.isActiveCellProtected()||this.execute(new u(this,c))},cellInputCreate:function(c,b){c.addClass(this.settings.classCellActiveInput);var d=c.width();c=b?b:c.text();b=a("<input>");b.css({width:d,"max-width":d});b.val(c);return b},cellInputDestroy:function(){var c=this.getCellInput(),a=c.val();c.remove();this.setCellInput(!1);return a},getCellInput:function(){return this._$cellInput},setCellInput:function(c){this._$cellInput=c},editStart:function(c){this.isActiveCellProtected()||
this.execute(new l(this,c))},editStop:function(){this.getCellInput();var c=!1;this.isEditing()&&(c=this.cellInputDestroy(),a(this.getActiveCell()).removeClass(this.settings.classCellActiveInput),this.setActiveCellValue(c),this.focus(),this.bindNavigateMode(),this.bindPrintableKeys(),c=!0);return c},editAccept:function(){this.editStop();this.navigateDown()},isEditing:function(){return!1!==this.getCellInput()},setCellValue:function(c,b,d){c=this.settings.onCellValueChangeBefore(c,b,d);a(this.getCell(b,
d)).text(c);this.settings.onCellValueChangeAfter(b,d)},setActiveCellValue:function(c){var a=this.getCellRow(),b=this.getCellCol();this.setCellValue(c,a,b)},setActiveCellValueSilent:function(c){if(!1!==c){var b=this.getActiveCell();a(b).text(c)}},editCancel:function(){this.editStop()&&this.editUndo()},editInsertColumn:function(c){this.execute(new q(this,c))},editDeleteColumn:function(c){this.execute(new CommandDeleteColumn(this,c))},editDuplicateRow:function(){this.execute(new m(this))},editDeleteRow:function(){this.execute(new r(this))},
editAppendRow:function(c,a){this.execute(new t(this,c,a))},editUndo:function(){this.getCommandExecutor().undo();this.refreshCells()},editRedo:function(){this.getCommandExecutor().redo()},onRowDuplicateAfter:function(c){this.settings.onRowDuplicateAfter(c)},onRowAppendAfter:function(c,a){this.settings.onRowAppendAfter(c,a)},onRowDeleteAfter:function(a){this.settings.onRowDeleteAfter(a)}});var k=function(){this._undoStack=[];this._redoStack=[]};k.prototype.getUndoStack=function(){return this._undoStack};
k.prototype.getRedoStack=function(){return this._redoStack};k.prototype.execute=function(a){a.execute();var c=this.getUndoStack(),b=c.peek();a.equals(b)||c.push(a)};k.prototype.undo=function(){var a=this.getUndoStack().pop();"undefined"!==typeof a&&(a.undo(),this.getRedoStack().push(a))};k.prototype.redo=function(){var a=this.getRedoStack().pop();"undefined"!==typeof a&&this.execute(a)};var g=function(a){this._plugin=a;this.saveState()};g.prototype.execute=function(){};g.prototype.equals=function(a){return"undefined"===
typeof a?!1:Object.equals(this.getState(),a.getState())};g.prototype.undo=function(){var a=this.getPlugin();"undefined"!==typeof this.getState()&&a.cellStateRestore(this.getState())};g.prototype.getId=function(){return(new Date).getTime()};g.prototype.saveState=function(){this.setState(this.getPlugin().cellStateRetrieve())};g.prototype.setState=function(a){this._state=a};g.prototype.getState=function(){return this._state};g.prototype.getPlugin=function(){return this._plugin};var n=function(a,b,d){a=
g.call(this,a)||this;a._row=b;a._col=d;return a};$jscomp.inherits(n,g);n.prototype.execute=function(){this.getPlugin()._navigate(this._row,this._col)};var p=function(a){return g.call(this,a)||this};$jscomp.inherits(p,g);p.prototype.execute=function(){var a=this.getPlugin();a.editCopy();a.editErase()};var l=function(a,b){a=g.call(this,a)||this;a._charCode=b;return a};$jscomp.inherits(l,g);l.prototype.execute=function(){var c=this.getPlugin();c.bindEditMode();c.unbindPrintableKeys();var b=a(c.getActiveCell()),
d=c.cellInputCreate(b,this._charCode);c.setCellInput(d);b.html(d);d.focus();d.on("focusout",function(){c.editStop()})};var u=function(a,b){a=g.call(this,a)||this;a._cellValue=b;return a};$jscomp.inherits(u,g);u.prototype.execute=function(){this.getPlugin().setActiveCellValue(this._cellValue)};var q=function(a,b){a=g.call(this,a)||this;a._columnName=b;return a};$jscomp.inherits(q,g);q.prototype.execute=function(){var b=this.getPlugin();b.deactivate();a(b.getTableBodyElement()).parent().find("thead");
b.activate()};var m=function(a){return g.call(this,a)||this};$jscomp.inherits(m,g);m.prototype.execute=function(){var a=this.getPlugin();a.deactivate();var b=this.getRow().clone();this.setState({id:this.getId(),clone:b});this.inject(b);a.activate()};m.prototype.inject=function(a){this.getRow().after(a);this.getPlugin().onRowDuplicateAfter(a)};m.prototype.undo=function(){this.getState().clone.remove()};m.prototype.getRow=function(){return a(this.getPlugin().getActiveCell()).closest("tr")};var t=function(a,
b,d){a=g.call(this,a)||this;a._content=b;a._classes=d;return a};$jscomp.inherits(t,g);t.prototype.saveState=function(){this.getPlugin().isActive()&&g.prototype.saveState.call(this)};t.prototype.execute=function(){var b=this,d=b.getPlugin();d=a(d.getTableBodyElement());var g="<tr>";d.prev("thead").find("tr:first > th").each(function(a){var c=b._content[a];a=b._classes[a];g+="<td";"undefined"!==typeof a&&0<a.length&&(g+=" class='"+a+"'");"undefined"===typeof c&&(c="");g+=">"+c+"</td>"});g+="</tr>";
d.append(g)};var r=function(a){return g.call(this,a)||this};$jscomp.inherits(r,g);r.prototype.execute=function(){var b=this.getPlugin();b.deactivate();var d=a(b.getActiveCell()).closest("tr");this.setState({id:this.getId(),row:d});d.remove();b.onRowDeleteAfter(d);b.activate()};r.prototype.undo=function(){this.getPlugin().editDeleteRow()};a.fn.ivy=function(b){var c;this.each(function(){a.data(this,"plugin_ivy")||(c=new h(this,b),a.data(this,"plugin_ivy",c))});return c};e.Plugin=h})(jQuery,window,document);$(document).ready(function(){var a={description:"Control application behaviour.",title:"Preferences",type:"object",properties:{active:{description:"Edit timesheet data for this month.",type:"string",format:"date",title:"Active Month"},weekdays:{description:"Predefine daily timeslots.",type:"array",title:"Weekdays",format:"table",uniqueItems:!0,items:{type:"object",required:"weekday",properties:{weekday:{title:"Weekday",type:"string","enum":[0,1,2,3,4,5,6],options:{enum_titles:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ")}},
times:{title:"Times",type:"array",format:"table",items:{type:"object",properties:{began:{type:"string",title:"Began"},ended:{type:"string",title:"Ended"}}}}}}},inclusion:{description:"Change what types of days are included.",type:"object",title:"Include",properties:{weekends:{type:"boolean",title:"Weekends",format:"checkbox"},holidays:{type:"boolean",title:"Holidays",format:"checkbox"}}},saving:{description:"Change timesheet persistence behaviour.",type:"object",title:"Saving",properties:{timeout:{description:"Time between autosaves, in seconds.",
type:"integer",title:"Autosave",format:"number"}}},columns:{description:"Columns for custom purposes (e.g. ticket number).",type:"array",title:"Columns",format:"tabs",maxItems:3,items:{type:"string",title:"Column"}},formats:{description:"Timesheet data formats; changing these can break the application.",title:"Format",type:"object",properties:{format_date:{description:"Format for timesheet day cells.",type:"string",title:"Date","default":"YYYY-MM-DD"},format_time:{description:"Format for timesheet time cells.",
type:"string",title:"Time","default":"HH:mm A"},format_prec:{description:"Decimal places to show for time calculations.",type:"integer",title:"Precision","default":2},format_keys:{description:"Internal format used as timesheet key index for local data storage.",type:"string",title:"Primary Key","default":"YYYYMM"}}}}},e=$("#ivy tbody").ivy({init:function(){this.initMenu();this.initHeadings();this.initTimesheet();this.initPreferencesDialog();this.initPreferencesEditor();this.initSuperhero();this.setChanged(!1)},
initMenu:function(){for(var a=this.getPlugin(),d=[{a:"edit-cut",f:"Cut"},{a:"edit-copy",f:"Copy"},{a:"edit-undo",f:"Undo"},{a:"edit-redo",f:"Redo"},{a:"insert-shift",f:"DuplicateRow"},{a:"delete-row",f:"DeleteRow"},{a:"append-day",f:"AppendRow"}],h=d.length,f={i:0};f.i<h;f={i:f.i},f.i++)$(".app-"+d[f.i].a).on("click",function(a){return function(b){e["edit"+d[a.i].f]()}}(f));this._exporter_csv=$(".ivy-export-csv").exportable({source:a.element,filename:"timesheet.csv"});this._exporter_json=$(".ivy-export-json").exportable({source:a.element,
filename:"timesheet.json"})},initHeadings:function(){var a=this.getPlugin();a=$(a.getTableBodyElement()).prev("thead").find("tr:first");for(var d=this.getPreferences().columns,e=d.length,f="",k=0;k<e;k++)f+="<th>"+d[k]+"</th>";a.append(f)},initTimesheet:function(){var a=this.getPlugin(),d=a.settings.classCellTransient,e=a.settings.classCellReadOnly,f=JSON.parse(this.loadTimesheet()),k=[];$.each(f,function(){var b=[];b.push(this.day);b.push("");b.push("");b.push(this.began.toTime());b.push(this.ended.toTime());
delete this.day;delete this.began;delete this.ended;if(0===k.length){k.push(e);k.push(d);k.push(d);for(var f=Object.keys(this).length+2,h=0;h<f;h++)k.push("")}for(var l in this)this.hasOwnProperty(l)&&b.push(this[l]);a.editAppendRow(b,k)});this.fillTimesheet(k)},fillTimesheet:function(a){console.log("fill timesheet");var b=this.getPlugin(),e=this.getPreferences(),f=$(b.getCellLastRow(0)).text();f=moment(f);var k=f.clone().add(1,"month");e=e.formats.format_date;for(f.add(1,"day");f.month()<k.month();)this.isWorkDay(f)?
(b.editAppendRow([f.format(e),"","","8:00".toTime(),"9:00".toTime()],a),f=this.getNextWorkDay(f)):f.add(1,"day");this.getPlugin().refreshCells()},initPreferencesDialog:function(){$("#settings").dialog({dialogClass:"settings-dialog",autoOpen:!1,maxHeight:.75*$(window).height(),height:"auto",width:"auto",closeOnEscape:!0,position:{my:"right top",at:"right top",of:window},buttons:{Ok:function(){$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}});$(".app-settings-preferences").on("click",
function(a){$("#settings").dialog("open")})},initPreferencesEditor:function(){var b=document.getElementById("editor");new JSONEditor(b,{theme:"jqueryui",disable_collapse:!0,disable_edit_json:!0,disable_properties:!0,disable_array_reorder:!0,disable_array_delete_all_rows:!0,disable_array_delete_last_row:!0,required_by_default:!0,no_additional_properties:!0,remove_empty_properties:!0,schema:a,startval:this.getPreferences()})},initSuperhero:function(){var a=this,d=a.getPreferences();$(window).on("unload",
function(){a.save()});setInterval(function(){a.save()},1E3*d.saving.timeout)},isWorkDay:function(a){return this.getPreferences().inclusion.weekends||!a.toDate().isWeekend()},getNextWorkDay:function(a){this.getPreferences();a=a.clone();do a.add(1,"day");while(!this.isWorkDay(a));return a},refreshCells:function(){for(var a=this.getPlugin().getMaxRows(),d=0;d<=a;d++)this.onCellValueChangeAfter(d,3)},onCellValueChangeBefore:function(a,d,e){if(3===e||4===e)a=a.toTime();return a},onCellValueChangeAfter:function(a,
d){if(2!==d||1!==d||0!==d){d=this.getPlugin();var b=this.getPreferences(),e=this.updateCellTime(a,3),k=this.updateCellTime(a,4,e,60);e=moment.duration(k.diff(e)).asHours();e.toFixed&&(e=Math.abs(e).toFixed(b.formats.format_prec));$(d.getCell(a,2)).text(e);a=this.findConsecutive(a,0);b=this.sumConsecutive(a);$(d.getCell(a[0],1)).text(b);this.setChanged(!0)}},onRowDuplicateAfter:function(a){var b=this.getPlugin(),e=a.find("td:eq(4)").text();a.find("td:not(:first-child)").empty();a=a.index();b.setCellValue(e,
a,3);b.refreshCells()},onRowDeleteAfter:function(a){a=this.getPlugin();if(0===a.getRowCount()){var b=a.settings.classCellTransient,e=a.settings.classCellReadOnly,f=moment();f=this.getNextWorkDay(f).format("YYYY-MM-01");a.editAppendRow([f,"","","8:00".toTime(),"9:00".toTime()],[e,b,b,"",""])}a.refreshCells()},updateCellTime:function(a,d,e,f){var b=this.getPlugin(),g=this.getPreferences();a=$(b.getCell(a,d));d=a.text();""==d&&(d=moment(e).add(f,"minutes"),d=d.format(g.formats.format_time),a.text(d));
return moment.utc(d,g.formats.format_time)},findConsecutive:function(a,d){for(var b=this.getPlugin(),e=a,k=$(b.getCell(a,d)).text(),g=k;k==g&&0<=--e;)g=$(b.getCell(e,d)).text();var n=e+1,p=b.getMaxRows();e=a;for(g=k;k==g&&++e<p;)g=$(b.getCell(e,d)).text();return[n,e-1]},sumConsecutive:function(a){for(var b=this.getPlugin(),e=this.getPreferences(),f=0,k=a[0];k<=a[1];k++)f+=parseFloat($(b.getCell(k,2)).text(),10)||0;f.toFixed&&(f=f.toFixed(e.formats.format_prec));return f},setChanged:function(a){this._changed=
a},getChanged:function(){return this._changed},getDataStore:function(){return localStorage},put:function(a,d){this.getDataStore().put(a,d)},get:function(a,d){return this.getDataStore().get(a,d)},loadTimesheet:function(){var a=this.getTimesheetKey();return this.get(a)},saveTimesheet:function(){var a=this.getTimesheetKey(),d=this.getTimesheetData();this.put(a,d)},getTimesheetKey:function(){var a=this.getPreferences();return moment(a.active,"YYYY-MM-DD").format(a.formats.format_keys)},getTimesheetData:function(){var a=
this.getPlugin().settings.classCellTransient;return this.getExporter().export_json("."+a)},getExporter:function(){return this._exporter_json},save:function(){this.getChanged()&&!1===this.getPlugin().isEditing()&&(this.setChanged(!1),this.saveTimesheet())},getDefaultPreferences:function(){return{active:moment().format("YYYY-MM-01"),formats:{format_date:"YYYY-MM-DD",format_time:"hh:mm A",format_prec:2,format_keys:"YYYYMM"},weekdays:[{weekday:1,times:[{began:"745",ended:"930"},{began:"930",ended:"1000"},
{began:"1000",ended:"345p"}]}],saving:{timeout:5},inclusion:{weekends:!1,holidays:!1},columns:["Description"]}},getPreferences:function(){return this.get("ivy.preferences",this.getDefaultPreferences())},setPreferences:function(a){this.put("ivy.preferences",a)},getPlugin:function(){return this.ivy}})});(function(a,e,b,d){function h(b,d){this.element=b;this.settings=a.extend({},f,d);this._defaults=f;this._name="exportable";this.init()}var f={source:"table",filename:"export.csv",exports:{csv:{file_extension:"csv",media_type_text:"text/csv",media_type_data:"application/csv",col_delimiter:'","',row_delimiter:'"\r\n"',temp_col_delimiter:String.fromCharCode(11),temp_row_delimiter:String.fromCharCode(0)},json:{file_extension:"json",media_type_text:"text/plain",media_type_data:"application/json"}},charset:"utf-8"};
a.extend(h.prototype,{init:function(){var b=this,d=b.settings.filename,e=d.slice((d.lastIndexOf(".")-1>>>0)+2);a(b.element).on("click tap",function(a){b[e]()})},toSelector:function(a,b){"undefined"===b&&(b="");return a+":not('"+b+"')"},export_csv:function(b){var d=this.settings,e=d.exports,k=e.csv.temp_row_delimiter,f=e.csv.temp_col_delimiter,h=e.csv.row_delimiter;e=e.csv.col_delimiter;var q=this.toSelector("td",b);return'"'+a(d.source).find("tr:has(td)").map(function(b,d){return a(d).find(q).map(function(b,
c){return a(c).text().replace(/"/g,'""')}).get().join(f)}).get().join(k).split(k).join(h).split(f).join(e)+'"'},csv:function(){var a=this.settings.exports,b=this.export_csv();this.download(b,a.csv)},export_json:function(b){var d=this.settings.source,e=[],f="thead > tr > "+this.toSelector("th",b),k=this.toSelector("td",b);a.each(a(d).parent().find(f),function(b,d){e.push(a(d).text().toLowerCase())});var h=[];a.each(a(d).find("tr"),function(b,d){var g={};a.each(a(this).find(k),function(b,c){g[e[b]]=
a(this).text().trim()});h.push(g)});return JSON.stringify(h)},json:function(){var a=this.settings.exports,b=this.export_json();this.download(b,a.json)},download:function(b,d){var f=this.settings;e.Blob&&e.URL?(b=new Blob([b],{type:d.meda_type_text+"; charset="+f.charset}),b=URL.createObjectURL(b)):b="data:"+d.media_type_data+"; charset="+f.charset+","+encodeURIComponent(b);a(this.element).attr({download:f.filename,href:b,target:""})},toArray:function(a){return a.split(this.settings.exports.csv.row_delimiter)}});
a.fn.exportable=function(b){var d;this.each(function(){a.data(this,"plugin_exportable")||(d=new h(this,b),a.data(this,"plugin_exportable",d))});return d};e.Plugin=h})(jQuery,window,document);
