var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(b){var c=function(){};c.prototype=b;return new c};$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0},c={};try{return c.__proto__=b,c.a}catch(e){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(b,c){b.__proto__=c;if(b.__proto__!==c)throw new TypeError(b+" is not extensible");return b}:null;
$jscomp.inherits=function(b,c){b.prototype=$jscomp.objectCreate(c.prototype);b.prototype.constructor=b;if($jscomp.setPrototypeOf){var e=$jscomp.setPrototypeOf;e(b,c)}else for(e in c)if("prototype"!=e)if(Object.defineProperties){var g=Object.getOwnPropertyDescriptor(c,e);g&&Object.defineProperty(b,e,g)}else b[e]=c[e];b.superClass_=c.prototype};
$jscomp.findInternal=function(b,c,e){b instanceof String&&(b=String(b));for(var g=b.length,h=0;h<g;h++){var m=b[h];if(c.call(e,m,h,b))return{i:h,v:m}}return{i:-1,v:void 0}};$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,e){b!=Array.prototype&&b!=Object.prototype&&(b[c]=e.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,c,e,g){if(c){e=$jscomp.global;b=b.split(".");for(g=0;g<b.length-1;g++){var h=b[g];h in e||(e[h]={});e=e[h]}b=b[b.length-1];g=e[b];c=c(g);c!=g&&null!=c&&$jscomp.defineProperty(e,b,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,e){return $jscomp.findInternal(this,b,e).v}},"es6","es3");
(function(b,c,e,g){function h(a,d){this.element=a;this.settings=b.extend({},m,d);this.settings.ivy=this;this._defaults=m;this._name="ivy";this._cell=[0,0];this._$cellInput=!1;this._commandExecutor=new l;this.init()}var m={classActiveCell:"active",classActiveCellInput:"edit",classCellReadOnly:"readonly",maxPageSize:30,dispatchKeysNavigate:[{k:"enter",f:"navigateDown"},{k:"up",f:"navigateUp"},{k:"down",f:"navigateDown"},{k:"left",f:"navigateLeft"},{k:"right",f:"navigateRight"},{k:"ctrl+up",f:"navigateUpSkip"},
{k:"ctrl+down",f:"navigateDownSkip"},{k:"ctrl+left",f:"navigateLeftSkip"},{k:"ctrl+right",f:"navigateRightSkip"},{k:"pageup",f:"navigatePageUp"},{k:"pagedown",f:"navigatePageDown"},{k:"home",f:"navigateRowHome"},{k:"end",f:"navigateRowEnd"},{k:"ctrl+home",f:"navigateHome"},{k:"ctrl+end",f:"navigateEnd"},{k:"shift+tab",f:"navigateLeft"},{k:"tab",f:"navigateRight"},{k:"f2",f:"editStart"},{k:"ctrl+x",f:"editCut"},{k:"ctrl+c",f:"editCopy"},{k:"ctrl+ins",f:"editCopy"},{k:"del",f:"editErase"},{k:"shift+del",
f:"editDeleteRow"},{k:"ins",f:"editInsertRow"},{k:"ctrl+i",f:"editInsertRow"},{k:"command+i",f:"editInsertRow"},{k:"shift+space",f:"editAppendRow"},{k:"ctrl+s",f:"editSave"},{k:"ctrl+z",f:"editUndo"},{k:"command+z",f:"editUndo"},{k:"ctrl+shift+z",f:"editRedo"},{k:"ctrl+y",f:"editRedo"},{k:"command+y",f:"editRedo"}],dispatchKeysEdit:[{k:"up",f:"navigateUp"},{k:"down",f:"navigateDown"},{k:"shift+tab",f:"navigateLeft"},{k:"tab",f:"navigateRight"},{k:"enter",f:"editStop"},{k:"esc",f:"editCancel"}],init:function(){},
refreshCells:function(){},onCellValueChangeBefore:function(a,d,b){return a},onCellValueChangeAfter:function(a,d){},onRowInsertAfter:function(a,d){},onRowAppendAfter:function(a,d){},onRowDeleteAfter:function(a){}};b.extend(h.prototype,{init:function(){this.settings.init();this.refreshCells();this.setup();this.bindNavigateMode();this.bindPrintableKeys();this.bindNavigationClicks();this.bindPasteHandler();this.activate()},refreshCells:function(){this.settings.refreshCells()},setup:function(){Mousetrap.prototype.stopCallback=
function(a,d,b){a.preventDefault();return!1}},navigateTableCell:function(a){var d=a.parent().children().index(a);a=a.parent().parent().children().index(a.parent());!1===this.isActiveCell(a,d)&&this.navigate(a,d)},bindNavigationClicks:function(){var a=this,d=b(a.getTableBodyElement());d.on("click","td",function(){a.navigateTableCell(b(this))});d.on("dblclick doubletap","td",function(){a.navigateTableCell(b(this));a.editStart()})},bindPrintableKeys:function(){var a=this;b(a.getTableBodyElement()).on("keypress",
function(d){var b="number"===typeof d.which?d.which:d.keyCode;"keypress"!==d.type||!b||d.ctrlKey||d.metaKey||(a.editStart(String.fromCharCode(b)),d.stopPropagation(),d.preventDefault())})},unbindPrintableKeys:function(){b(this.getTableBodyElement()).off("keypress")},_bindDispatchKeys:function(a){Mousetrap.reset();for(var d=this,b={},c=0;c<a.length;b={f:b.f},c++){var e=a[c].k;b.f=a[c].f;Mousetrap.bind(e,function(a){return function(b){d[a.f]()}}(b))}},bindNavigateMode:function(){this._bindDispatchKeys(this.settings.dispatchKeysNavigate)},
bindEditMode:function(){this._bindDispatchKeys(this.settings.dispatchKeysEdit)},bindPasteHandler:function(){var a=this;b(e).on("paste",function(d){if(d.originalEvent){var b=d.originalEvent.clipboardData.getData("text");a.cellUpdate(b);d.stopPropagation();d.preventDefault()}})},_sanitizeCellIndex:function(a,b){return a>b?b:0>a?0:a},getTableBodyElement:function(){return b(this.element)[0]},getCellRow:function(){return this._cell[0]},getCellCol:function(){return this._cell[1]},setCellRow:function(a){this._cell[0]=
this._sanitizeCellIndex(a,this.getMaxRows())},setCellCol:function(a){this._cell[1]=this._sanitizeCellIndex(a,this.getMaxCols())},getCell:function(a,b){return this.getTableBodyElement().rows[a].cells[b]},getCellLastRow:function(a){var b=this.getMaxRows();return this.getCell(b,a)},getActiveCell:function(){var a=this.getCellRow(),b=this.getCellCol();return this.getCell(a,b)},getMaxRows:function(){return this.getTableBodyElement().rows.length-1},getMaxCols:function(){return this.getTableBodyElement().rows[0].cells.length-
1},isActiveCell:function(a,b){return this.isActiveCellRow(a)&&this.isActiveCellCol(b)},isActiveCellRow:function(a){return a===this.getCellRow()},isActiveCellCol:function(a){return a===this.getCellCol()},isActiveCellReadOnly:function(){return b(this.getActiveCell()).hasClass(this.settings.classCellReadOnly)},activate:function(){this.setCellRow(this.getCellRow());this.setCellCol(this.getCellCol());b(this.getActiveCell()).addClass(this.settings.classActiveCell)},deactivate:function(){b(this.getActiveCell()).removeClass(this.settings.classActiveCell)},
cellStateRetrieve:function(){var a=b(this.getActiveCell());return{cellRow:this.getCellRow(),cellCol:this.getCellCol(),cellValue:a.text()}},cellStateRestore:function(a){this._navigate(a.cellRow,a.cellCol);this.setActiveCellValue(a.cellValue)},getCommandExecutor:function(){return this._commandExecutor},execute:function(a){this.getCommandExecutor().execute(a)},focus:function(){b(this.getTableBodyElement()).focus()},_navigate:function(a,b){this.deactivate();this.setCellRow(a);this.setCellCol(b);this.activate();
this.focus()},navigate:function(a,b){this.editStop();this.execute(new q(this,a,b))},navigateRow:function(a){this.navigate(this.getCellRow()+a,this.getCellCol())},navigateCol:function(a){this.navigate(this.getCellRow(),this.getCellCol()+a)},navigatePageUp:function(){this.navigateRow(-this.settings.maxPageSize)},navigatePageDown:function(){this.navigateRow(+this.settings.maxPageSize)},navigateUp:function(){this.navigateRow(-1)},navigateDown:function(){this.navigateRow(1)},navigateLeft:function(){this.navigateCol(-1)},
navigateRight:function(){this.navigateCol(1)},navigateUpSkip:function(){console.log("Navigate up skip");this.navigateRow(-1)},navigateDownSkip:function(){console.log("Navigate down skip");this.navigateRow(1)},navigateLeftSkip:function(){console.log("Navigate left skip");this.navigateCol(-1)},navigateRightSkip:function(){console.log("Navigate right skip");this.navigateCol(1)},navigateHome:function(){this.navigate(0,0)},navigateEnd:function(){this.navigate(1E3,1E3)},navigateRowHome:function(){this.navigateCol(-1E3)},
navigateRowEnd:function(){this.navigateCol(1E3)},editCut:function(){this.execute(new r(this))},editCopy:function(){var a=b("<input>"),d=b(this.getActiveCell());b("body").append(a);a.val(d.text()).select();e.execCommand("copy");a.remove()},editErase:function(){this.cellUpdate("")},cellUpdate:function(a){this.isActiveCellReadOnly()||this.execute(new t(this,a))},cellInputCreate:function(a,d){a.addClass(this.settings.classActiveCellInput);var c=a.width();a=d?d:a.text();d=b("<input>");d.css({width:c,"max-width":c});
d.val(a);return d},cellInputDestroy:function(){var a=this.getCellInput(),b=a.val();a.remove();this.setCellInput(!1);return b},getCellInput:function(){return this._$cellInput},setCellInput:function(a){this._$cellInput=a},editStart:function(a){this.isActiveCellReadOnly()||this.execute(new u(this,a))},editStop:function(){var a=!1;!1!==this.getCellInput()&&(a=this.cellInputDestroy(),b(this.getActiveCell()).removeClass(this.settings.classActiveCellInput),this.setActiveCellValue(a),this.focus(),this.bindNavigateMode(),
this.bindPrintableKeys(),a=!0);return a},setCellValue:function(a,d,c){a=this.settings.onCellValueChangeBefore(a,d,c);b(this.getCell(d,c)).text(a);this.settings.onCellValueChangeAfter(d,c)},setActiveCellValue:function(a){var b=this.getCellRow(),c=this.getCellCol();this.setCellValue(a,b,c)},setActiveCellValueSilent:function(a){console.log("setActiveCellValueSilent "+a);if(!1!==a){var d=this.getActiveCell();b(d).text(a)}},editCancel:function(){this.editStop()&&this.editUndo()},editSave:function(){console.log("Save cells")},
editInsertColumn:function(a){this.execute(new v(this,a))},editDeleteColumn:function(a){this.execute(new CommandDeleteColumn(this,a))},editInsertRow:function(){this.execute(new k(this))},editDeleteRow:function(){0<this.getMaxRows()&&this.execute(new n(this))},editAppendRow:function(){this.execute(new p(this))},editUndo:function(){this.getCommandExecutor().undo()},editRedo:function(){this.getCommandExecutor().redo()}});var l=function(){this._undoStack=[];this._redoStack=[]};l.prototype.getUndoStack=
function(){return this._undoStack};l.prototype.getRedoStack=function(){return this._redoStack};l.prototype.execute=function(a){a.execute();var b=this.getUndoStack(),c=b.peek();a.equals(c)||b.push(a)};l.prototype.undo=function(){var a=this.getUndoStack().pop();"undefined"!==typeof a&&(a.undo(),this.getRedoStack().push(a))};l.prototype.redo=function(){var a=this.getRedoStack().pop();"undefined"!==typeof a&&this.execute(a)};var f=function(a){this._plugin=a;this.saveState()};f.prototype.execute=function(){};
f.prototype.equals=function(a){return"undefined"===typeof a?!1:Object.equals(this.getState(),a.getState())};f.prototype.undo=function(){var a=this.getPlugin();a.cellStateRestore(this.getState());a.refreshCells()};f.prototype.getId=function(){return(new Date).getTime()};f.prototype.saveState=function(){this.setState(this.getPlugin().cellStateRetrieve())};f.prototype.setState=function(a){this._state=a};f.prototype.getState=function(){return this._state};f.prototype.getPlugin=function(){return this._plugin};
var q=function(a,b,c){a=f.call(this,a)||this;a._row=b;a._col=c;return a};$jscomp.inherits(q,f);q.prototype.execute=function(){this.getPlugin()._navigate(this._row,this._col)};var r=function(a){return f.call(this,a)||this};$jscomp.inherits(r,f);r.prototype.execute=function(){var a=this.getPlugin();a.editCopy();a.editErase()};var u=function(a,b){a=f.call(this,a)||this;a._charCode=b;return a};$jscomp.inherits(u,f);u.prototype.execute=function(){var a=this.getPlugin();a.bindEditMode();a.unbindPrintableKeys();
var d=b(a.getActiveCell()),c=a.cellInputCreate(d,this._charCode);console.log(d.html());a.setCellInput(c);d.html(c);c.focus();c.on("focusout",function(){a.editStop()})};var t=function(a,b){a=f.call(this,a)||this;a._cellValue=b;return a};$jscomp.inherits(t,f);t.prototype.execute=function(){this.getPlugin().setActiveCellValue(this._cellValue)};var v=function(a,b){a=f.call(this,a)||this;a._columnName=b;return a};$jscomp.inherits(v,f);v.prototype.execute=function(){var a=this.getPlugin();a.deactivate();
b(a.getTableBodyElement()).parent().find("thead");a.activate()};var k=function(a){return f.call(this,a)||this};$jscomp.inherits(k,f);k.prototype.execute=function(){var a=this.getPlugin();a.deactivate();var b=this.getRow().clone();this.setState({id:this.getId(),clone:b});this.inject(b);a.activate()};k.prototype.inject=function(a){var b=this.getRow();b.after(a);this.getPlugin().settings.onRowInsertAfter(b,a)};k.prototype.undo=function(){this.getState().clone.remove();this.getPlugin().refreshCells()};
k.prototype.getRow=function(){return b(this.getPlugin().getActiveCell()).closest("tr")};var p=function(a){return k.call(this,a)||this};$jscomp.inherits(p,k);p.prototype.inject=function(a){var b=this.getRow();b.after(a);this.getPlugin().settings.onRowAppendAfter(b,a)};p.prototype.getRow=function(){return b(this.getPlugin().getTableBodyElement()).find("tr:last")};var n=function(a){return f.call(this,a)||this};$jscomp.inherits(n,f);n.prototype.execute=function(){var a=this.getPlugin();a.deactivate();
var c=b(a.getActiveCell()).closest("tr");this.setState({id:this.getId(),row:c});c.remove();a.settings.onRowDeleteAfter(c);a.refreshCells();a.activate()};n.prototype.undo=function(){var a=this.getPlugin();a.editInsertRow();a.refreshCells()};b.fn.ivy=function(a){var c;this.each(function(){b.data(this,"plugin_ivy")||(c=new h(this,a),b.data(this,"plugin_ivy",c))});return c};c.Plugin=h})(jQuery,window,document);Array.prototype.peek=function(){return this[this.length-1]};
Object.equals=function(b,c){if(!(b instanceof Object&&c instanceof Object))return!1;for(var e in b)if(b.hasOwnProperty(e)&&(!c.hasOwnProperty(e)||b[e]!==c[e]&&!Object.equals(b[e],c[e])))return!1;return!0};
