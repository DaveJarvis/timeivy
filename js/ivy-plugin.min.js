var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(b){var c=function(){};c.prototype=b;return new c};$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0},c={};try{return c.__proto__=b,c.a}catch(d){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(b,c){b.__proto__=c;if(b.__proto__!==c)throw new TypeError(b+" is not extensible");return b}:null;
$jscomp.inherits=function(b,c){b.prototype=$jscomp.objectCreate(c.prototype);b.prototype.constructor=b;if($jscomp.setPrototypeOf){var d=$jscomp.setPrototypeOf;d(b,c)}else for(d in c)if("prototype"!=d)if(Object.defineProperties){var g=Object.getOwnPropertyDescriptor(c,d);g&&Object.defineProperty(b,d,g)}else b[d]=c[d];b.superClass_=c.prototype};
$jscomp.findInternal=function(b,c,d){b instanceof String&&(b=String(b));for(var g=b.length,h=0;h<g;h++){var n=b[h];if(c.call(d,n,h,b))return{i:h,v:n}}return{i:-1,v:void 0}};$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,d){b!=Array.prototype&&b!=Object.prototype&&(b[c]=d.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,c,d,g){if(c){d=$jscomp.global;b=b.split(".");for(g=0;g<b.length-1;g++){var h=b[g];h in d||(d[h]={});d=d[h]}b=b[b.length-1];g=d[b];c=c(g);c!=g&&null!=c&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,d){return $jscomp.findInternal(this,b,d).v}},"es6","es3");
(function(b,c,d,g){function h(a,f){this.element=a;this.settings=b.extend({},n,f);this.settings.ivy=this;this._defaults=n;this._name="ivy";this._cell=[0,0];this._$cellInput=!1;this._commandExecutor=new l;this.init()}var n={classActiveCell:"active",classActiveCellInput:"edit",classCellReadOnly:"readonly",maxPageSize:30,columns:[],dispatchKeysNavigate:[{k:"enter",f:"navigateDown"},{k:"up",f:"navigateUp"},{k:"down",f:"navigateDown"},{k:"left",f:"navigateLeft"},{k:"right",f:"navigateRight"},{k:"ctrl+up",
f:"navigateUpSkip"},{k:"ctrl+down",f:"navigateDownSkip"},{k:"ctrl+left",f:"navigateLeftSkip"},{k:"ctrl+right",f:"navigateRightSkip"},{k:"pageup",f:"navigatePageUp"},{k:"pagedown",f:"navigatePageDown"},{k:"home",f:"navigateRowHome"},{k:"end",f:"navigateRowEnd"},{k:"ctrl+home",f:"navigateHome"},{k:"ctrl+end",f:"navigateEnd"},{k:"shift+tab",f:"navigateLeft"},{k:"tab",f:"navigateRight"},{k:"f2",f:"editStart"},{k:"ctrl+x",f:"editCut"},{k:"ctrl+c",f:"editCopy"},{k:"ctrl+ins",f:"editCopy"},{k:"del",f:"editErase"},
{k:"ins",f:"editInsertRow"},{k:"ctrl+i",f:"editInsertRow"},{k:"command+i",f:"editInsertRow"},{k:"shift+del",f:"editDeleteRow"},{k:"shift+space",f:"editAppendRow"},{k:"ctrl+s",f:"editSave"},{k:"ctrl+z",f:"editUndo"},{k:"command+z",f:"editUndo"},{k:"ctrl+shift+z",f:"editRedo"},{k:"ctrl+y",f:"editRedo"},{k:"command+y",f:"editRedo"}],dispatchKeysEdit:[{k:"up",f:"navigateUp"},{k:"down",f:"navigateDown"},{k:"shift+tab",f:"navigateLeft"},{k:"tab",f:"navigateRight"},{k:"enter",f:"editStop"},{k:"esc",f:"editCancel"}],
onInit:function(){},onCellValueChangeBefore:function(a,b,m){return a},onCellValueChangeAfter:function(a,b){},onRowInsertAfter:function(a,b){},onRowAppendAfter:function(a,b){},onRowDeleteAfter:function(a){}};b.extend(h.prototype,{init:function(){this.settings.onInit();this.setup();this.bindNavigateMode();this.bindPrintableKeys();this.bindNavigationClicks();this.bindPasteHandler();this.activate()},setup:function(){Mousetrap.prototype.stopCallback=function(a,b,m){a.preventDefault();return!1}},navigateTableCell:function(a){var b=
a.parent().children().index(a);a=a.parent().parent().children().index(a.parent());!1===this.isActiveCell(a,b)&&this.navigate(a,b)},bindNavigationClicks:function(){var a=this,f=b(a.getTableBodyElement());f.on("click","td",function(){a.navigateTableCell(b(this))});f.on("dblclick","td",function(){a.navigateTableCell(b(this));a.editStart()})},bindPrintableKeys:function(){var a=this;b(a.getTableBodyElement()).on("keypress",function(b){var f="number"===typeof b.which?b.which:b.keyCode;"keypress"!==b.type||
!f||b.ctrlKey||b.metaKey||a.editStart(String.fromCharCode(f))})},unbindPrintableKeys:function(){b(this.getTableBodyElement()).off("keypress")},_bindDispatchKeys:function(a){Mousetrap.reset();for(var b=this,m={},c=0;c<a.length;m={f:m.f},c++){var d=a[c].k;m.f=a[c].f;Mousetrap.bind(d,function(a){return function(f){b[a.f]()}}(m))}},bindNavigateMode:function(){this._bindDispatchKeys(this.settings.dispatchKeysNavigate)},bindEditMode:function(){this._bindDispatchKeys(this.settings.dispatchKeysEdit)},bindPasteHandler:function(){var a=
this;b(d).on("paste",function(b){if(b.originalEvent){var f=b.originalEvent.clipboardData.getData("text");a.cellUpdate(f);b.stopPropagation();b.preventDefault()}})},_sanitizeCellIndex:function(a,b){return a>b?b:0>a?0:a},getCellRow:function(){return this._cell[0]},getCellCol:function(){return this._cell[1]},getTableBodyElement:function(){return b(this.element)[0]},getActiveCell:function(){var a=this.getCellRow(),b=this.getCellCol();return this.getCell(a,b)},getCell:function(a,b){return this.getTableBodyElement().rows[a].cells[b]},
setCellRow:function(a){this._cell[0]=this._sanitizeCellIndex(a,this.getMaxRows())},setCellCol:function(a){this._cell[1]=this._sanitizeCellIndex(a,this.getMaxCols())},getMaxRows:function(){return this.getTableBodyElement().rows.length-1},getMaxCols:function(){return this.getTableBodyElement().rows[0].cells.length-1},isActiveCell:function(a,b){return this.isActiveCellRow(a)&&this.isActiveCellCol(b)},isActiveCellRow:function(a){return a===this.getCellRow()},isActiveCellCol:function(a){return a===this.getCellCol()},
isActiveCellReadOnly:function(){return b(this.getActiveCell()).hasClass(this.settings.classCellReadOnly)},activate:function(){b(this.getActiveCell()).addClass(this.settings.classActiveCell)},deactivate:function(){b(this.getActiveCell()).removeClass(this.settings.classActiveCell)},cellStateRetrieve:function(){var a=b(this.getActiveCell());return{cellRow:this.getCellRow(),cellCol:this.getCellCol(),cellValue:a.text()}},cellStateRestore:function(a){this._navigate(a.cellRow,a.cellCol);this.setActiveCellValue(a.cellValue)},
getCommandExecutor:function(){return this._commandExecutor},execute:function(a){this.getCommandExecutor().execute(a)},focus:function(){b(this.getTableBodyElement()).focus()},_navigate:function(a,b){this.deactivate();this.setCellRow(a);this.setCellCol(b);this.activate();this.focus()},navigate:function(a,b){this.editStop();this.execute(new r(this,a,b))},navigateRow:function(a){this.navigate(this.getCellRow()+a,this.getCellCol())},navigateCol:function(a){this.navigate(this.getCellRow(),this.getCellCol()+
a)},navigatePageUp:function(){this.navigateRow(-this.settings.maxPageSize)},navigatePageDown:function(){this.navigateRow(+this.settings.maxPageSize)},navigateUp:function(){this.navigateRow(-1)},navigateDown:function(){this.navigateRow(1)},navigateLeft:function(){this.navigateCol(-1)},navigateRight:function(){this.navigateCol(1)},navigateUpSkip:function(){console.log("Navigate up skip");this.navigateRow(-1)},navigateDownSkip:function(){console.log("Navigate down skip");this.navigateRow(1)},navigateLeftSkip:function(){console.log("Navigate left skip");
this.navigateCol(-1)},navigateRightSkip:function(){console.log("Navigate right skip");this.navigateCol(1)},navigateHome:function(){this.navigate(0,0)},navigateEnd:function(){this.navigate(1E3,1E3)},navigateRowHome:function(){this.navigateCol(-1E3)},navigateRowEnd:function(){this.navigateCol(1E3)},editCut:function(){this.execute(new t(this))},editCopy:function(){var a=b("<input>"),f=b(this.getActiveCell());b("body").append(a);a.val(f.text()).select();d.execCommand("copy");a.remove()},editErase:function(){this.cellUpdate("")},
cellUpdate:function(a){this.isActiveCellReadOnly()||this.execute(new u(this,a))},cellInputCreate:function(a){a.addClass(this.settings.classActiveCellInput);var f=a.width();a=a.text();var c=b("<input>");c.prop({type:"text",value:a});c.css({width:f,"max-width":f});return c},cellInputDestroy:function(){var a=this.getCellInput(),b=a.val();a.remove();this.setCellInput(!1);return b},getCellInput:function(){return this._$cellInput},setCellInput:function(a){this._$cellInput=a},editStart:function(a){this.isActiveCellReadOnly()||
this.execute(new v(this,a))},editStop:function(){var a=!1;!1!==this.getCellInput()&&(a=this.cellInputDestroy(),b(this.getActiveCell()).removeClass(this.settings.classActiveCellInput),this.setActiveCellValue(a),this.focus(),this.bindNavigateMode(),this.bindPrintableKeys(),a=!0);return a},setCellValue:function(a,f,c){a=this.settings.onCellValueChangeBefore(a,f,c);b(this.getCell(f,c)).text(a);this.settings.onCellValueChangeAfter(f,c)},setActiveCellValue:function(a){var b=this.getCellRow(),c=this.getCellCol();
this.setCellValue(a,b,c)},setActiveCellValueSilent:function(a){if(!1!==a){var c=this.getActiveCell();b(c).text(a)}},editCancel:function(){this.editStop()&&this.editUndo()},editSave:function(){console.log("Save cells")},editInsertRow:function(){this.execute(new k(this))},editDeleteRow:function(){this.execute(new p(this))},editAppendRow:function(){this.execute(new q(this))},editUndo:function(){this.getCommandExecutor().undo()},editRedo:function(){this.getCommandExecutor().redo()}});var l=function(){this._undoStack=
[];this._redoStack=[]};l.prototype.getUndoStack=function(){return this._undoStack};l.prototype.getRedoStack=function(){return this._redoStack};l.prototype.execute=function(a){a.execute();var b=this.getUndoStack(),c=b.peek();a.equals(c)||b.push(a)};l.prototype.undo=function(){var a=this.getUndoStack().pop();"undefined"!==typeof a&&(a.undo(),this.getRedoStack().push(a))};l.prototype.redo=function(){var a=this.getRedoStack().pop();"undefined"!==typeof a&&this.execute(a)};var e=function(a){this._plugin=
a;this.saveState()};e.prototype.execute=function(){};e.prototype.equals=function(a){return"undefined"===typeof a?!1:Object.equals(this.getState(),a.getState())};e.prototype.undo=function(){this.getPlugin().cellStateRestore(this.getState())};e.prototype.getId=function(){return(new Date).getTime()};e.prototype.saveState=function(){this.setState(this.getPlugin().cellStateRetrieve())};e.prototype.setState=function(a){this._state=a};e.prototype.getState=function(){return this._state};e.prototype.getPlugin=
function(){return this._plugin};var r=function(a,b,c){a=e.call(this,a)||this;a._row=b;a._col=c;return a};$jscomp.inherits(r,e);r.prototype.execute=function(){this.getPlugin()._navigate(this._row,this._col)};var t=function(a){return e.call(this,a)||this};$jscomp.inherits(t,e);t.prototype.execute=function(){var a=this.getPlugin();a.editCopy();a.editErase()};var v=function(a,b){var c=e.call(this,a)||this;a.setActiveCellValueSilent(b);return c};$jscomp.inherits(v,e);v.prototype.execute=function(){var a=
this.getPlugin();a.bindEditMode();a.unbindPrintableKeys();var c=b(a.getActiveCell()),d=a.cellInputCreate(c);a.setCellInput(d);d.on("focusout",function(){a.editStop()});c.html(d);d.focus()};var u=function(a,b){a=e.call(this,a)||this;a._cellValue=b;return a};$jscomp.inherits(u,e);u.prototype.execute=function(){this.getPlugin().setActiveCellValue(this._cellValue)};var k=function(a){return e.call(this,a)||this};$jscomp.inherits(k,e);k.prototype.execute=function(){var a=this.getPlugin();a.deactivate();
var b=this.getRow().clone();this.setState({id:this.getId(),clone:b});this.inject(b);a.activate()};k.prototype.inject=function(a){var b=this.getPlugin(),c=this.getRow();c.after(a);b.settings.onRowInsertAfter(c,a)};k.prototype.undo=function(){this.getState().clone.remove()};k.prototype.getRow=function(){var a=this.getPlugin();return b(a.getActiveCell()).closest("tr")};var q=function(a){return k.call(this,a)||this};$jscomp.inherits(q,k);q.prototype.inject=function(a){var b=this.getPlugin(),c=this.getRow();
c.after(a);b.settings.onRowAppendAfter(c,a)};q.prototype.getRow=function(){var a=this.getPlugin();return b(a.getTableBodyElement()).find("tr:last")};var p=function(a){return e.call(this,a)||this};$jscomp.inherits(p,e);p.prototype.execute=function(){var a=this.getPlugin();a.deactivate();var c=b(a.getActiveCell()).closest("tr");this.setState({id:this.getId(),row:c});c.remove();a.settings.onRowDeleteAfter(c);a.activate()};p.prototype.undo=function(){console.log("delete row")};b.fn.ivy=function(a){var c;
this.each(function(){b.data(this,"plugin_ivy")||(c=new h(this,a),b.data(this,"plugin_ivy",c))});return c};c.Plugin=h})(jQuery,window,document);Array.prototype.peek=function(){return this[this.length-1]};Object.equals=function(b,c){if(!(b instanceof Object&&c instanceof Object))return!1;for(var d in b)if(b.hasOwnProperty(d)&&(!c.hasOwnProperty(d)||b[d]!==c[d]&&!Object.equals(b[d],c[d])))return!1;return!0};
