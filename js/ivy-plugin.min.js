var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(b){var d=function(){};d.prototype=b;return new d};$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0},d={};try{return d.__proto__=b,d.a}catch(f){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(b,d){b.__proto__=d;if(b.__proto__!==d)throw new TypeError(b+" is not extensible");return b}:null;
$jscomp.inherits=function(b,d){b.prototype=$jscomp.objectCreate(d.prototype);b.prototype.constructor=b;if($jscomp.setPrototypeOf){var f=$jscomp.setPrototypeOf;f(b,d)}else for(f in d)if("prototype"!=f)if(Object.defineProperties){var k=Object.getOwnPropertyDescriptor(d,f);k&&Object.defineProperty(b,f,k)}else b[f]=d[f];b.superClass_=d.prototype};
(function(b,d,f,k){function l(a,c){this.element=a;this.settings=b.extend({},t,c);this.settings.ivy=this;this._defaults=t;this._name="ivy";this._cell=[0,0];this._$cellInput=!1;this._commandExecutor=new g;this.init()}var t={classActiveCell:"active",classActiveCellInput:"edit",classCellReadOnly:"readonly",maxPageSize:30,maxUndoLevels:1E3,dispatchKeysNavigate:[{k:"enter",f:"navigateDown"},{k:"up",f:"navigateUp"},{k:"down",f:"navigateDown"},{k:"left",f:"navigateLeft"},{k:"right",f:"navigateRight"},{k:"ctrl+up",
f:"navigateUpSkip"},{k:"ctrl+down",f:"navigateDownSkip"},{k:"ctrl+left",f:"navigateLeftSkip"},{k:"ctrl+right",f:"navigateRightSkip"},{k:"pageup",f:"navigatePageUp"},{k:"pagedown",f:"navigatePageDown"},{k:"home",f:"navigateRowHome"},{k:"end",f:"navigateRowEnd"},{k:"ctrl+home",f:"navigateHome"},{k:"ctrl+end",f:"navigateEnd"},{k:"shift+tab",f:"navigateLeft"},{k:"tab",f:"navigateRight"},{k:"ctrl+x",f:"cellCut"},{k:"ctrl+c",f:"cellCopy"},{k:"ctrl+ins",f:"cellCopy"},{k:"del",f:"cellErase"},{k:"f2",f:"cellEditStart"},
{k:"ins",f:"editInsertRow"},{k:"ctrl+i",f:"editInsertRow"},{k:"command+i",f:"editInsertRow"},{k:"ctrl+del",f:"editDeleteRow"},{k:"ctrl+s",f:"editSave"},{k:"ctrl+z",f:"editUndo"},{k:"command+z",f:"editUndo"},{k:"ctrl+shift+z",f:"editRedo"},{k:"ctrl+y",f:"editRedo"},{k:"command+y",f:"editRedo"}],dispatchKeysEdit:[{k:"up",f:"navigateUp"},{k:"down",f:"navigateDown"},{k:"shift+tab",f:"navigateLeft"},{k:"tab",f:"navigateRight"},{k:"enter",f:"cellEditStop"},{k:"esc",f:"cellEditCancel"}],onInit:function(){},
onCellValueChangeBefore:function(a,c,b){return a},onCellValueChangeAfter:function(a,c){},onRowInsertAfter:function(a,c){}};b.extend(l.prototype,{init:function(){this.settings.onInit();this.setup();this.bindNavigateMode();this.bindPrintableKeys();this.bindNavigationClicks();this.bindPasteHandler();this.activate()},setup:function(){Mousetrap.prototype.stopCallback=function(a,c,b){a.preventDefault();return!1}},navigateTableCell:function(a){var c=a.parent().children().index(a);a=a.parent().parent().children().index(a.parent());
!1===this.isActiveCell(a,c)&&this.navigate(a,c)},bindNavigationClicks:function(){var a=this,c=b(a.getTableBodyElement());c.on("click","td",function(){a.navigateTableCell(b(this))});c.on("dblclick","td",function(){a.navigateTableCell(b(this));a.cellEditStart()})},bindPrintableKeys:function(){var a=this;b(a.getTableBodyElement()).on("keypress",function(c){var b="number"===typeof c.which?c.which:c.keyCode;"keypress"!==c.type||!b||c.ctrlKey||c.metaKey||a.cellEditStart(String.fromCharCode(b))})},unbindPrintableKeys:function(){b(this.getTableBodyElement()).off("keypress")},
_bindDispatchKeys:function(a){Mousetrap.reset();for(var c=this,b={},d=0;d<a.length;b={f:b.f},d++){var e=a[d].k;b.f=a[d].f;Mousetrap.bind(e,function(a){return function(b){c[a.f]()}}(b))}},bindNavigateMode:function(){this._bindDispatchKeys(this.settings.dispatchKeysNavigate)},bindEditMode:function(){this._bindDispatchKeys(this.settings.dispatchKeysEdit)},bindPasteHandler:function(){var a=this;b(f).on("paste",function(c){if(c.originalEvent){var b=c.originalEvent.clipboardData.getData("text");a.cellUpdate(b);
c.stopPropagation();c.preventDefault()}})},sanitizeCellIndex:function(a,c){return a>c?c:0>a?0:a},getCellRow:function(){return this._cell[0]},getCellCol:function(){return this._cell[1]},getTableBodyElement:function(){return b(this.element)[0]},getActiveCell:function(){var a=this.getCellRow(),c=this.getCellCol();return this.getCell(a,c)},getCell:function(a,c){return this.getTableBodyElement().rows[a].cells[c]},setCellRow:function(a){this._cell[0]=this.sanitizeCellIndex(a,this.getMaxRows())},setCellCol:function(a){this._cell[1]=
this.sanitizeCellIndex(a,this.getMaxCols())},getMaxRows:function(){return this.getTableBodyElement().rows.length-1},getMaxCols:function(){return this.getTableBodyElement().rows[0].cells.length-1},isActiveCell:function(a,c){return this.isActiveCellRow(a)&&this.isActiveCellCol(c)},isActiveCellRow:function(a){return a===this.getCellRow()},isActiveCellCol:function(a){return a===this.getCellCol()},isActiveCellReadOnly:function(){return b(this.getActiveCell()).hasClass(this.settings.classCellReadOnly)},
activate:function(){b(this.getActiveCell()).addClass(this.settings.classActiveCell)},deactivate:function(){b(this.getActiveCell()).removeClass(this.settings.classActiveCell)},cellStateRetrieve:function(){return{cellRow:this.getCellRow(),cellCol:this.getCellCol(),cellValue:b(this.getActiveCell()).text()}},cellStateRestore:function(a){this._navigate(a.cellRow,a.cellCol);this.setActiveCellValue(a.cellValue)},getCommandExecutor:function(){return this._commandExecutor},execute:function(a){this.getCommandExecutor().execute(a)},
focus:function(){b(this.getTableBodyElement()).focus()},_navigate:function(a,c){this.deactivate();this.setCellRow(a);this.setCellCol(c);this.activate();this.focus()},navigate:function(a,c){this.cellEditStop();this.execute(new m(this,a,c))},navigateRow:function(a){this.navigate(this.getCellRow()+a,this.getCellCol())},navigateCol:function(a){this.navigate(this.getCellRow(),this.getCellCol()+a)},navigatePageUp:function(){this.navigateRow(-this.settings.maxPageSize)},navigatePageDown:function(){this.navigateRow(+this.settings.maxPageSize)},
navigateUp:function(){this.navigateRow(-1)},navigateDown:function(){this.navigateRow(1)},navigateLeft:function(){this.navigateCol(-1)},navigateRight:function(){this.navigateCol(1)},navigateUpSkip:function(){console.log("Navigate up skip");this.navigateRow(-1)},navigateDownSkip:function(){console.log("Navigate down skip");this.navigateRow(1)},navigateLeftSkip:function(){console.log("Navigate left skip");this.navigateCol(-1)},navigateRightSkip:function(){console.log("Navigate right skip");this.navigateCol(1)},
navigateHome:function(){this.navigate(0,0)},navigateEnd:function(){this.navigate(1E3,1E3)},navigateRowHome:function(){this.navigateCol(-1E3)},navigateRowEnd:function(){this.navigateCol(1E3)},cellCut:function(){this.execute(new n(this))},cellCopy:function(){var a=b("<input>");b("body").append(a);a.val(b(this.getActiveCell()).text()).select();f.execCommand("copy");a.remove()},cellErase:function(){this.cellUpdate("")},cellUpdate:function(a){this.isActiveCellReadOnly()||this.execute(new p(this,a))},cellInputCreate:function(a){a.addClass(this.settings.classActiveCellInput);
var c=a.width();a=a.text();var d=b("<input>");d.prop({type:"text",value:a});d.css({width:c,"max-width":c});return d},cellInputDestroy:function(){var a=this.getCellInput(),c=a.val();a.remove();this.setCellInput(!1);return c},getCellInput:function(){return this._$cellInput},setCellInput:function(a){this._$cellInput=a},cellEditStart:function(a){this.isActiveCellReadOnly()||this.execute(new q(this,a))},cellEditStop:function(){var a=!1;!1!==this.getCellInput()&&(a=this.cellInputDestroy(),b(this.getActiveCell()).removeClass(this.settings.classActiveCellInput),
this.setActiveCellValue(a),this.focus(),this.bindNavigateMode(),this.bindPrintableKeys(),a=!0);return a},setCellValue:function(a,c,d){a=this.settings.onCellValueChangeBefore(a,c,d);b(this.getCell(c,d)).text(a);this.settings.onCellValueChangeAfter(c,d)},setActiveCellValue:function(a){var c=this.getCellRow(),b=this.getCellCol();this.setCellValue(a,c,b)},setActiveCellValueSilent:function(a){!1!==a&&b(this.getActiveCell()).text(a)},cellEditCancel:function(){this.cellEditStop()&&this.editUndo()},editSave:function(){console.log("Save cells")},
editInsertRow:function(){this.execute(new h(this))},editDeleteRow:function(){this.execute(new r(this))},editUndo:function(){this.getCommandExecutor().undo()},editRedo:function(){this.getCommandExecutor().redo()}});b.fn.ivy=function(a){return this.each(function(){if(!b.data(this,"plugin_ivy")){var c=new l(this,a);b.data(this,"plugin_ivy",c)}})};var g=function(){this._undoStack=[];this._redoStack=[]};g.prototype.getUndoStack=function(){return this._undoStack};g.prototype.getRedoStack=function(){return this._redoStack};
g.prototype.execute=function(a){a.execute();var c=this.getUndoStack(),b=c.peek();a.equals(b)||c.push(a)};g.prototype.undo=function(){var a=this.getUndoStack().pop();"undefined"!==typeof a&&(a.undo(),this.getRedoStack().push(a))};g.prototype.redo=function(){var a=this.getRedoStack().pop();"undefined"!==typeof a&&this.execute(a)};var e=function(a){this._plugin=a;this.saveState()};e.prototype.execute=function(){};e.prototype.equals=function(a){return"undefined"===typeof a?!1:Object.equals(this.getState(),
a.getState())};e.prototype.undo=function(){this.getPlugin().cellStateRestore(this.getState())};e.prototype.saveState=function(){this.setState(this.getPlugin().cellStateRetrieve())};e.prototype.setState=function(a){this._state=a};e.prototype.getState=function(){return this._state};e.prototype.getPlugin=function(){return this._plugin};var m=function(a,c,b){a=e.call(this,a)||this;a._row=c;a._col=b;return a};$jscomp.inherits(m,e);m.prototype.execute=function(){this.getPlugin()._navigate(this._row,this._col)};
var n=function(a){return e.call(this,a)||this};$jscomp.inherits(n,e);n.prototype.execute=function(){var a=this.getPlugin();a.cellCopy();a.cellErase()};var q=function(a,b){var c=e.call(this,a)||this;a.setActiveCellValueSilent(b);return c};$jscomp.inherits(q,e);q.prototype.execute=function(){var a=this.getPlugin();a.bindEditMode();a.unbindPrintableKeys();var c=b(a.getActiveCell()),d=a.cellInputCreate(c);a.setCellInput(d);d.on("focusout",function(){a.cellEditStop()});c.html(d);d.focus()};var p=function(a,
b){a=e.call(this,a)||this;a._cellValue=b;return a};$jscomp.inherits(p,e);p.prototype.execute=function(){this.getPlugin().setActiveCellValue(this._cellValue)};var h=function(a){return e.call(this,a)||this};$jscomp.inherits(h,e);h.prototype.execute=function(){var a=this.getPlugin();a.deactivate();var c=b(a.getActiveCell()).closest("tr"),d=c.clone();this.setState({id:this.getId(),clone:d});c.after(d);a.settings.onRowInsertAfter(c,d);a.activate()};h.prototype.undo=function(){this.getState().clone.remove()};
h.prototype.getId=function(){return(new Date).getTime()};var r=function(a){return e.call(this,a)||this};$jscomp.inherits(r,e);r.prototype.execute=function(){console.log("delete row")};d.Plugin=l})(jQuery,window,document);Array.prototype.peek=function(){return this[this.length-1]};Object.equals=function(b,d){if(!(b instanceof Object&&d instanceof Object))return!1;for(var f in b)if(b.hasOwnProperty(f)&&(!d.hasOwnProperty(f)||b[f]!==d[f]&&!Object.equals(b[f],d[f])))return!1;return!0};
