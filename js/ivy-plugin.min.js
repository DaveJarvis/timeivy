var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(b){var d=function(){};d.prototype=b;return new d};$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0},d={};try{return d.__proto__=b,d.a}catch(f){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(b,d){b.__proto__=d;if(b.__proto__!==d)throw new TypeError(b+" is not extensible");return b}:null;
$jscomp.inherits=function(b,d){b.prototype=$jscomp.objectCreate(d.prototype);b.prototype.constructor=b;if($jscomp.setPrototypeOf){var f=$jscomp.setPrototypeOf;f(b,d)}else for(f in d)if("prototype"!=f)if(Object.defineProperties){var k=Object.getOwnPropertyDescriptor(d,f);k&&Object.defineProperty(b,f,k)}else b[f]=d[f];b.superClass_=d.prototype};
(function(b,d,f,k){function l(a,c){this.element=a;this.settings=b.extend({},q,c);this._defaults=q;this._name="ivy";this._cell=[0,0];this._$cellInput=!1;this._commandExecutor=new g;this.init()}var q={classActiveCell:"active",classActiveCellInput:"edit",maxPageSize:30,maxUndoLevels:1E3,modeNavigate:[{k:"left",f:"navigateLeft"},{k:"right",f:"navigateRight"},{k:"up",f:"navigateUp"},{k:"down",f:"navigateDown"},{k:"ctrl+left",f:"navigateLeftSkip"},{k:"ctrl+right",f:"navigateRightSkip"},{k:"ctrl+up",f:"navigateUpSkip"},
{k:"ctrl+down",f:"navigateDownSkip"},{k:"pageup",f:"navigatePageUp"},{k:"pagedown",f:"navigatePageDown"},{k:"ctrl+pageup",f:"navigateSheetFore"},{k:"ctrl+pagedown",f:"navigateSheetAnte"},{k:"home",f:"navigateRowHome"},{k:"end",f:"navigateRowEnd"},{k:"ctrl+home",f:"navigateHome"},{k:"ctrl+end",f:"navigateEnd"},{k:"shift+tab",f:"navigateLeft"},{k:"tab",f:"navigateRight"},{k:"ctrl+x",f:"cellCut"},{k:"ctrl+c",f:"cellCopy"},{k:"ctrl+ins",f:"cellCopy"},{k:"del",f:"cellErase"},{k:"f2",f:"cellEditStart"},
{k:"enter",f:"cellEditStart"},{k:"esc",f:"cellEditCancel"},{k:"ins",f:"editInsertRowAfter"},{k:"alt+ins",f:"editInsertRowBefore"},{k:"ctrl+i",f:"editInsertRowAfter"},{k:"ctrl+shift+i",f:"editInsertRowBefore"},{k:"ctrl+s",f:"editSave"},{k:"ctrl+z",f:"editUndo"},{k:"ctrl+shift+z",f:"editRedo"},{k:"ctrl+y",f:"editRedo"}],modeEdit:[{k:"up",f:"navigateUp"},{k:"down",f:"navigateDown"},{k:"enter",f:"cellEditStop"}]};b.extend(l.prototype,{init:function(){this.setup();this.bindNavigateMode();this.bindPrintableKeys();
this.bindNavigationClicks();this.bindPasteHandler();this.activate()},setup:function(){Mousetrap.prototype.stopCallback=function(a,c,b){a.preventDefault();return!1}},navigateTableCell:function(a){var c=a.parent().children().index(a);a=a.parent().parent().children().index(a.parent());!1===this.isActiveCell(a,c)&&this.navigate(a,c)},bindNavigationClicks:function(){var a=this,c=b(a.getTableBodyElement());c.on("click","td",function(){a.navigateTableCell(b(this))});c.on("dblclick","td",function(){a.navigateTableCell(b(this));
a.cellEditStart()})},bindPrintableKeys:function(){var a=b(this.getTableBodyElement());a.keypress(function(a){var c="number"===typeof a.which?a.which:a.keyCode;"keypress"===a.type&&c&&!a.ctrlKey&&console.log("KEYPRESS!")});a.focus()},bindNavigateMode:function(){Mousetrap.reset();for(var a=this,c=this.settings.modeNavigate,b={},d=0;d<c.length;b={f:b.f},d++){var e=c[d].k;b.f=c[d].f;Mousetrap.bind(e,function(c){return function(b){eval("plugin."+c.f).call(a)}}(b))}},bindPasteHandler:function(){var a=this;
b(f).on("paste",function(c){if(c.originalEvent){var b=c.originalEvent.clipboardData.getData("text");a.execute(new h(a,b));c.stopPropagation();c.preventDefault()}})},sanitizeCellIndex:function(a,c){return a>c?c:0>a?0:a},getCellRow:function(){return this._cell[0]},getCellCol:function(){return this._cell[1]},getTableBodyElement:function(){return b(this.element)[0]},getTableCell:function(){var a=this.getTableBodyElement(),c=this.getCellRow(),b=this.getCellCol();return a.rows[c].cells[b]},setCellRow:function(a){var c=
this.getTableBodyElement().rows.length-1;this._cell[0]=this.sanitizeCellIndex(a,c)},setCellCol:function(a){var c=this.getTableBodyElement(),b=this.getCellRow();this._cell[1]=this.sanitizeCellIndex(a,c.rows[b].cells.length-1)},isActiveCell:function(a,c){return this.isActiveCellRow(a)&&this.isActiveCellCol(c)},isActiveCellRow:function(a){return a===this.getCellRow()},isActiveCellCol:function(a){return a===this.getCellCol()},activate:function(){b(this.getTableCell()).addClass(this.settings.classActiveCell)},
deactivate:function(){b(this.getTableCell()).removeClass(this.settings.classActiveCell)},retrieveState:function(){return{cellRow:this.getCellRow(),cellCol:this.getCellCol(),cellVal:b(this.getTableCell()).text()}},restoreState:function(a){this._navigate(a.cellRow,a.cellCol);b(this.getTableCell()).text(a.cellVal)},getCommandExecutor:function(){return this._commandExecutor},execute:function(a){this.getCommandExecutor().execute(a)},_navigate:function(a,c){this.deactivate();this.setCellRow(a);this.setCellCol(c);
this.activate()},navigate:function(a,c){!1!==this.getCellInput()&&this.cellEditStop();this.execute(new m(this,a,c))},navigateRow:function(a){this.navigate(this.getCellRow()+a,this.getCellCol())},navigateCol:function(a){this.navigate(this.getCellRow(),this.getCellCol()+a)},navigatePageUp:function(){this.navigateRow(-this.settings.maxPageSize)},navigatePageDown:function(){this.navigateRow(+this.settings.maxPageSize)},navigateUp:function(){this.navigateRow(-1)},navigateDown:function(){this.navigateRow(1)},
navigateLeft:function(){this.navigateCol(-1)},navigateRight:function(){this.navigateCol(1)},navigateUpSkip:function(){console.log("Navigate up skip");this.navigateRow(-1)},navigateDownSkip:function(){console.log("Navigate down skip");this.navigateRow(1)},navigateLeftSkip:function(){console.log("Navigate left skip");this.navigateCol(-1)},navigateRightSkip:function(){console.log("Navigate right skip");this.navigateCol(1)},navigateHome:function(){this.navigate(0,0)},navigateEnd:function(){this.navigate(1E3,
1E3)},navigateRowHome:function(){this.navigateCol(-1E3)},navigateRowEnd:function(){this.navigateCol(1E3)},navigateSheetFore:function(){console.log("Navigate forward")},navigateSheetAnte:function(){console.log("Navigate backward")},cellCut:function(){this.execute(new n(this))},cellCopy:function(){var a=b("<input>");b("body").append(a);a.val(b(this.getTableCell()).text()).select();f.execCommand("copy");a.remove()},cellErase:function(){this.execute(new h(this,""))},cellInputCreate:function(a){a.addClass(this.settings.classActiveCellInput);
var c=a.width();a=a.text();var d=b("<input>");d.prop({type:"text",value:a});d.css({width:c,"max-width":c});return d},cellInputDestroy:function(){var a=this.getCellInput(),c=a.val();a.remove();this.setCellInput(!1);return c},getCellInput:function(){return this._$cellInput},setCellInput:function(a){this._$cellInput=a},cellEditStart:function(){this.execute(new p(this))},cellEditStop:function(){var a=b(this.getTableBodyElement()),c=this.cellInputDestroy(),d=b(this.getTableCell());d.removeClass(this.settings.classActiveCellInput);
d.text(c);a.focus()},cellEditCancel:function(){console.log("Edit cancel");this.cellEditStop()},editSave:function(){console.log("Save cells");this.cellEditStop()},editInsertRowBefore:function(){console.log("Insert row before")},editInsertRowAfter:function(){console.log("Insert row after")},editUndo:function(){this.getCommandExecutor().undo()},editRedo:function(){this.getCommandExecutor().redo()}});b.fn.ivy=function(a){return this.each(function(){if(!b.data(this,"plugin_ivy")){var c=new l(this,a);b.data(this,
"plugin_ivy",c)}})};var g=function(){this._undoStack=[];this._redoStack=[]};g.prototype.getUndoStack=function(){return this._undoStack};g.prototype.getRedoStack=function(){return this._redoStack};g.prototype.execute=function(a){a.execute();this.getUndoStack().push(a)};g.prototype.undo=function(){var a=this.getUndoStack().pop();"undefined"!==typeof a&&(a.undo(),this.getRedoStack().push(a))};g.prototype.redo=function(){var a=this.getRedoStack().pop();"undefined"!==typeof a&&this.execute(a)};var e=function(a){this._plugin=
a;this._state=a.retrieveState()};e.prototype.execute=function(){};e.prototype.undo=function(){this.getPlugin().restoreState(this.getState())};e.prototype.getState=function(){return this._state};e.prototype.getPlugin=function(){return this._plugin};var m=function(a,c,b){a=e.call(this,a)||this;a._row=c;a._col=b;return a};$jscomp.inherits(m,e);m.prototype.execute=function(){this.getPlugin()._navigate(this._row,this._col)};var n=function(a){return e.call(this,a)||this};$jscomp.inherits(n,e);n.prototype.execute=
function(){var a=this.getPlugin();a.cellCopy();a.cellErase()};var p=function(a,b){return e.call(this,a)||this};$jscomp.inherits(p,e);p.prototype.execute=function(){var a=this.getPlugin(),c=b(a.getTableCell()),d=a.cellInputCreate(c);a.setCellInput(d);d.on("focusout",function(){c.text(d.val())});c.html(d);d.focus()};var h=function(a,b){a=e.call(this,a)||this;a._cellValue=b;return a};$jscomp.inherits(h,e);h.prototype.execute=function(){var a=this.getPlugin();b(a.getTableCell()).text(this._cellValue)};
d.Plugin=l})(jQuery,window,document);
