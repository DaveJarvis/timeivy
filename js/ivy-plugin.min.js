(function(c,f,g,k){function d(a,b){this.element=a;this.settings=c.extend({},h,b);this._defaults=h;this._name="ivy";this._cell=[0,0];this._$cellInput=!1;this._navigationMode=!0;this.init()}var h={classActiveCell:"active",classActiveCellInput:"edit",pageSize:30,modeNavigate:[{k:"left",f:"navigateLeft"},{k:"right",f:"navigateRight"},{k:"up",f:"navigateUp"},{k:"down",f:"navigateDown"},{k:"ctrl+left",f:"navigateLeftSkip"},{k:"ctrl+right",f:"navigateRightSkip"},{k:"ctrl+up",f:"navigateUpSkip"},{k:"ctrl+down",
f:"navigateDownSkip"},{k:"pageup",f:"navigatePageUp"},{k:"pagedown",f:"navigatePageDown"},{k:"ctrl+pageup",f:"navigateSheetFore"},{k:"ctrl+pagedown",f:"navigateSheetAnte"},{k:"home",f:"navigateRowHome"},{k:"end",f:"navigateRowEnd"},{k:"ctrl+home",f:"navigateHome"},{k:"ctrl+end",f:"navigateEnd"},{k:"shift+tab",f:"navigateLeft"},{k:"tab",f:"navigateRight"},{k:"ctrl+x",f:"cellCut"},{k:"ctrl+c",f:"cellCopy"},{k:"ctrl+ins",f:"cellCopy"},{k:"del",f:"cellErase"},{k:"f2",f:"cellEditStart"},{k:"enter",f:"cellEditStart"},
{k:"esc",f:"cellEditCancel"},{k:"ins",f:"editInsertRowAfter"},{k:"alt+ins",f:"editInsertRowBefore"},{k:"ctrl+s",f:"editSave"},{k:"ctrl+z",f:"editUndo"},{k:"ctrl+shift+z",f:"editRedo"}],modeEdit:[{k:"up",f:"navigateUp"},{k:"down",f:"navigateDown"}]};c.extend(d.prototype,{init:function(){this.bindNavigateMode();this.bindPrintableKeys();this.bindNavigationClicks();this.bindPasteHandler();this.activate()},navigateTableCell:function(a){var b=a.parent().children().index(a);a=a.parent().parent().children().index(a.parent());
this.navigate(a,b)},bindNavigationClicks:function(){var a=this,b=c(a.getTableBodyElement());b.on("click","td",function(){a.navigateTableCell(c(this))});b.on("dblclick","td",function(){a.navigateTableCell(c(this));a.cellEditStart()})},bindPrintableKeys:function(){var a=c(this.getTableBodyElement());a.keypress(function(a){var b="number"===typeof a.which?a.which:a.keyCode;"keypress"===a.type&&b&&!a.ctrlKey&&console.log("KEYPRESS WTF!")});a.focus()},bindNavigateMode:function(){Mousetrap.reset();for(var a=
this,b=this.settings.modeNavigate,c={},e=0;e<b.length;c={f:c.f},e++){var d=b[e].k;c.f=b[e].f;Mousetrap.bind(d,function(b){return function(c){eval("plugin."+b.f).call(a)}}(c))}},bindPasteHandler:function(){var a=this;c(a.getTableBodyElement()).on("paste",function(b){a.clipboardPaste(b)})},sanitizeCellIndex:function(a,b){return a>b?b:0>a?0:a},getCellRow:function(){return this._cell[0]},getCellCol:function(){return this._cell[1]},getTableBodyElement:function(){return c(this.element)[0]},getTableCell:function(){var a=
this.getTableBodyElement(),b=this.getCellRow(),c=this.getCellCol();return a.rows[b].cells[c]},setCellRow:function(a){var b=this.getTableBodyElement().rows.length;this._cell[0]=this.sanitizeCellIndex(a,b)},setCellCol:function(a){var b=this.getTableBodyElement(),c=this.getCellRow();this._cell[1]=this.sanitizeCellIndex(a,b.rows[c].cells.length)},activate:function(){c(this.getTableCell()).addClass(this.settings.classActiveCell)},deactivate:function(){c(this.getTableCell()).removeClass(this.settings.classActiveCell)},
navigate:function(a,b){this.cellEditStop();this.deactivate();this.setCellRow(a);this.setCellCol(b);this.activate()},navigateRow:function(a){this.navigate(this.getCellRow()+a,this.getCellCol())},navigateCol:function(a){this.navigate(this.getCellRow(),this.getCellCol()+a)},navigatePageUp:function(){this.navigateRow(-this.settings.pageSize)},navigatePageDown:function(){this.navigateRow(+this.settings.pageSize)},navigateUpSkip:function(){console.log("Navigate up skip")},navigateDownSkip:function(){console.log("Navigate down skip")},
navigateUp:function(){this.navigateRow(-1)},navigateDown:function(){this.navigateRow(1)},navigateLeft:function(){this.navigateCol(-1)},navigateLeftSkip:function(){this.navigateCol(-1)},navigateRight:function(){this.navigateCol(1)},navigateRightSkip:function(){this.navigateCol(1)},navigateHome:function(){this.navigate(0,0)},navigateEnd:function(){this.navigate(1E3,1E3)},navigateRowHome:function(){this.navigateCol(-1E3)},navigateRowEnd:function(){this.navigateCol(1E3)},navigateSheetFore:function(){console.log("Navigate forward")},
navigateSheetAnte:function(){console.log("Navigate backward")},cellCut:function(){this.cellCopy();this.cellErase()},cellCopy:function(){this.clipboardCopy(this.getTableCell())},cellErase:function(){c(this.getTableCell()).text("")},cellInputCreate:function(a){a.addClass(this.settings.classActiveCellInput);var b=a.width();a=a.text();var d=c("<input>");d.prop({type:"text",value:a});d.css({width:b,"max-width":b});return d},cellInputDestroy:function(){var a=this.getCellInput(),b=a.val();a.remove();this.setCellInput(!1);
return b},getCellInput:function(){return this._$cellInput},setCellInput:function(a){this._$cellInput=a},cellEditStart:function(){var a=c(this.getTableCell()),b=this.cellInputCreate(a);this.setCellInput(b);b.on("focusout",function(){a.text(b.val())});a.html(b);b.focus()},cellEditStop:function(){if(!1!==this.getCellInput()){var a=this.cellInputDestroy(),b=c(this.getTableCell());b.removeClass(this.settings.classActiveCellInput);b.text(a)}c(this.getTableBodyElement()).focus()},cellEditCancel:function(){console.log("Edit cancel");
this.cellEditStop()},editSave:function(){console.log("Save timesheet");this.cellEditStop()},editInsertRowBefore:function(){console.log("Insert row before")},editInsertRowAfter:function(){console.log("Insert row after")},editUndo:function(){console.log("Timesheet undo")},editRedo:function(){console.log("Timesheet redo")},clipboardCopy:function(a){var b=c("<input>");c("body").append(b);b.val(c(a).text()).select();g.execCommand("copy");b.remove()},clipboardPaste:function(a){a=a.originalEvent.clipboardData.getData("text");
c(this.getTableCell()).text(a)}});c.fn.ivy=function(a){return this.each(function(){if(!c.data(this,"plugin_ivy")){var b=new d(this,a);c.data(this,"plugin_ivy",b)}})};f.Plugin=d})(jQuery,window,document);Mousetrap.prototype.stopCallback=function(c,f,g){c.preventDefault();return!1};
