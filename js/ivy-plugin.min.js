var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(b){var d=function(){};d.prototype=b;return new d};$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0},d={};try{return d.__proto__=b,d.a}catch(e){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(b,d){b.__proto__=d;if(b.__proto__!==d)throw new TypeError(b+" is not extensible");return b}:null;
$jscomp.inherits=function(b,d){b.prototype=$jscomp.objectCreate(d.prototype);b.prototype.constructor=b;if($jscomp.setPrototypeOf){var e=$jscomp.setPrototypeOf;e(b,d)}else for(e in d)if("prototype"!=e)if(Object.defineProperties){var p=Object.getOwnPropertyDescriptor(d,e);p&&Object.defineProperty(b,e,p)}else b[e]=d[e];b.superClass_=d.prototype};
(function(b,d,e,p){function q(a,f){this.element=a;this.settings=b.extend({},A,f);this._defaults=A;this._name="ivy";this._cell=[0,0];this._$cellInput=!1;this._commandExecutor=new g;this.init()}var A={classActiveCell:"active",classActiveCellInput:"edit",maxPageSize:30,maxUndoLevels:1E3,modeNavigate:[{k:"left",f:"navigateLeft"},{k:"right",f:"navigateRight"},{k:"up",f:"navigateUp"},{k:"down",f:"navigateDown"},{k:"ctrl+left",f:"navigateLeftSkip"},{k:"ctrl+right",f:"navigateRightSkip"},{k:"ctrl+up",f:"navigateUpSkip"},
{k:"ctrl+down",f:"navigateDownSkip"},{k:"pageup",f:"navigatePageUp"},{k:"pagedown",f:"navigatePageDown"},{k:"ctrl+pageup",f:"navigateSheetFore"},{k:"ctrl+pagedown",f:"navigateSheetAnte"},{k:"home",f:"navigateRowHome"},{k:"end",f:"navigateRowEnd"},{k:"ctrl+home",f:"navigateHome"},{k:"ctrl+end",f:"navigateEnd"},{k:"shift+tab",f:"navigateLeft"},{k:"tab",f:"navigateRight"},{k:"ctrl+x",f:"cellCut"},{k:"ctrl+c",f:"cellCopy"},{k:"ctrl+ins",f:"cellCopy"},{k:"del",f:"cellErase"},{k:"f2",f:"cellEditStart"},
{k:"enter",f:"cellEditStart"},{k:"esc",f:"cellEditCancel"},{k:"ins",f:"editInsertRowAfter"},{k:"alt+ins",f:"editInsertRowBefore"},{k:"ctrl+i",f:"editInsertRowAfter"},{k:"ctrl+shift+i",f:"editInsertRowBefore"},{k:"ctrl+s",f:"editSave"},{k:"ctrl+z",f:"editUndo"},{k:"ctrl+shift+z",f:"editRedo"},{k:"ctrl+y",f:"editRedo"}],modeEdit:[{k:"up",f:"navigateUp"},{k:"down",f:"navigateDown"},{k:"enter",f:"cellEditStop"}]};b.extend(q.prototype,{init:function(){this.setup();this.bindNavigateMode();this.bindPrintableKeys();
this.bindNavigationClicks();this.bindPasteHandler();this.activate()},setup:function(){Mousetrap.prototype.stopCallback=function(a,f,b){a.preventDefault();return!1}},navigateTableCell:function(a){var f=a.parent().children().index(a);a=a.parent().parent().children().index(a.parent());this.navigate(a,f)},bindNavigationClicks:function(){var a=this,f=b(a.getTableBodyElement());f.on("click","td",function(){a.navigateTableCell(b(this))});f.on("dblclick","td",function(){a.navigateTableCell(b(this));a.cellEditStart()})},
bindPrintableKeys:function(){var a=b(this.getTableBodyElement());a.keypress(function(a){var b="number"===typeof a.which?a.which:a.keyCode;"keypress"===a.type&&b&&!a.ctrlKey&&console.log("KEYPRESS!")});a.focus()},bindNavigateMode:function(){Mousetrap.reset();for(var a=this,b=this.settings.modeNavigate,c={},d=0;d<b.length;c={f:c.f},d++){var e=b[d].k;c.f=b[d].f;Mousetrap.bind(e,function(b){return function(f){eval("plugin."+b.f).call(a)}}(c))}},bindPasteHandler:function(){var a=this;b(a.getTableBodyElement()).on("paste",
function(b){a.editPaste(b)})},sanitizeCellIndex:function(a,b){return a>b?b:0>a?0:a},getCellRow:function(){return this._cell[0]},getCellCol:function(){return this._cell[1]},getTableBodyElement:function(){return b(this.element)[0]},getTableCell:function(){var a=this.getTableBodyElement(),b=this.getCellRow(),c=this.getCellCol();return a.rows[b].cells[c]},setCellRow:function(a){var b=this.getTableBodyElement().rows.length-1;this._cell[0]=this.sanitizeCellIndex(a,b)},setCellCol:function(a){var b=this.getTableBodyElement(),
c=this.getCellRow();this._cell[1]=this.sanitizeCellIndex(a,b.rows[c].cells.length-1)},activate:function(){b(this.getTableCell()).addClass(this.settings.classActiveCell)},deactivate:function(){b(this.getTableCell()).removeClass(this.settings.classActiveCell)},retrieveState:function(){return{cellRow:this.getCellRow(),cellCol:this.getCellCol(),cellVal:b(this.getTableCell()).text()}},restoreState:function(a){this.navigate(a.cellRow,a.cellCol);b(this.getTableCell()).text(a.cellVal)},getCommandExecutor:function(){return this._commandExecutor},
execute:function(a){this.getCommandExecutor().execute(a)},navigate:function(a,b){this.cellEditStop();this.deactivate();this.setCellRow(a);this.setCellCol(b);this.activate()},navigateRow:function(a){this.navigate(this.getCellRow()+a,this.getCellCol())},navigateCol:function(a){this.navigate(this.getCellRow(),this.getCellCol()+a)},navigatePageUp:function(){this.execute(new r(this))},navigatePageDown:function(){this.execute(new t(this))},navigateUpSkip:function(){console.log("Navigate up skip");this.execute(new h(this))},
navigateDownSkip:function(){console.log("Navigate down skip");this.execute(new k(this))},navigateUp:function(){this.execute(new h(this))},navigateDown:function(){this.execute(new k(this))},navigateLeft:function(){this.execute(new l(this))},navigateLeftSkip:function(){console.log("Navigate left skip");this.execute(new l(this))},navigateRight:function(){this.execute(new m(this))},navigateRightSkip:function(){console.log("Navigate right skip");this.execute(new m(this))},navigateHome:function(){this.execute(new u(this))},
navigateEnd:function(){this.execute(new v(this))},navigateRowHome:function(){this.execute(new w(this))},navigateRowEnd:function(){this.execute(new x(this))},navigateSheetFore:function(){console.log("Navigate forward")},navigateSheetAnte:function(){console.log("Navigate backward")},cellCut:function(){this.execute(new y(this))},cellCopy:function(){var a=b("<input>");b("body").append(a);a.val(b(this.getTableCell()).text()).select();e.execCommand("copy");a.remove()},cellErase:function(){this.execute(new n(this,
""))},cellInputCreate:function(a){a.addClass(this.settings.classActiveCellInput);var c=a.width();a=a.text();var d=b("<input>");d.prop({type:"text",value:a});d.css({width:c,"max-width":c});return d},cellInputDestroy:function(){var a=this.getCellInput(),b=a.val();a.remove();this.setCellInput(!1);return b},getCellInput:function(){return this._$cellInput},setCellInput:function(a){this._$cellInput=a},cellEditStart:function(){var a=b(this.getTableCell()),c=this.cellInputCreate(a);this.setCellInput(c);c.on("focusout",
function(){a.text(c.val())});a.html(c);c.focus()},cellEditStop:function(){var a=b(this.getTableBodyElement());if(!1!==this.getCellInput()){var c=this.cellInputDestroy();this.execute(new z(this));var d=b(this.getTableCell());d.removeClass(this.settings.classActiveCellInput);d.text(c)}a.focus()},cellEditCancel:function(){console.log("Edit cancel");this.cellEditStop()},editSave:function(){console.log("Save cells");this.cellEditStop()},editInsertRowBefore:function(){console.log("Insert row before")},
editInsertRowAfter:function(){console.log("Insert row after")},editUndo:function(){this.getCommandExecutor().undo()},editRedo:function(){this.getCommandExecutor().redo()},editPaste:function(a){a=a.originalEvent.clipboardData.getData("text");this.execute(new n(this,a))}});b.fn.ivy=function(a){return this.each(function(){if(!b.data(this,"plugin_ivy")){var c=new q(this,a);b.data(this,"plugin_ivy",c)}})};var g=function(){this._undoStack=[];this._redoStack=[]};g.prototype.getUndoStack=function(){return this._undoStack};
g.prototype.getRedoStack=function(){return this._redoStack};g.prototype.execute=function(a){a.execute();this.getUndoStack().push(a)};g.prototype.undo=function(){var a=this.getUndoStack().pop();"undefined"!==typeof a&&(a.undo(),this.getRedoStack().push(a))};g.prototype.redo=function(){var a=this.getRedoStack().pop();"undefined"!==typeof a&&this.execute(a)};var c=function(a){this._plugin=a;this._state=a.retrieveState()};c.prototype.execute=function(){};c.prototype.undo=function(){this.getPlugin().restoreState(this.getState())};
c.prototype.getState=function(){return this._state};c.prototype.getPlugin=function(){return this._plugin};c.prototype.getTableCell=function(){return this.getPlugin().getTableCell()};var k=function(a){return c.call(this,a)||this};$jscomp.inherits(k,c);k.prototype.execute=function(){this.getPlugin().navigateRow(1)};var h=function(a){return c.call(this,a)||this};$jscomp.inherits(h,c);h.prototype.execute=function(){this.getPlugin().navigateRow(-1)};var l=function(a){return c.call(this,a)||this};$jscomp.inherits(l,
c);l.prototype.execute=function(){this.getPlugin().navigateCol(-1)};var m=function(a){return c.call(this,a)||this};$jscomp.inherits(m,c);m.prototype.execute=function(){this.getPlugin().navigateCol(1)};var u=function(a){return c.call(this,a)||this};$jscomp.inherits(u,c);u.prototype.execute=function(){this.getPlugin().navigate(0,0)};var v=function(a){return c.call(this,a)||this};$jscomp.inherits(v,c);v.prototype.execute=function(){this.getPlugin().navigate(1E3,1E3)};var w=function(a){return c.call(this,
a)||this};$jscomp.inherits(w,c);w.prototype.execute=function(){this.getPlugin().navigateCol(-1E3)};var x=function(a){return c.call(this,a)||this};$jscomp.inherits(x,c);x.prototype.execute=function(){this.getPlugin().navigateCol(1E3)};var r=function(a){return c.call(this,a)||this};$jscomp.inherits(r,c);r.prototype.execute=function(){var a=this.getPlugin();a.navigateRow(-a.settings.maxPageSize)};var t=function(a){return c.call(this,a)||this};$jscomp.inherits(t,c);t.prototype.execute=function(){var a=
this.getPlugin();a.navigateRow(+a.settings.maxPageSize)};var y=function(a){return c.call(this,a)||this};$jscomp.inherits(y,c);y.prototype.execute=function(){var a=this.getPlugin();a.cellCopy();a.cellErase()};var n=function(a,b){a=c.call(this,a)||this;a._cellValue=b;return a};$jscomp.inherits(n,c);n.prototype.execute=function(){b(this.getTableCell()).text(this._cellValue)};var z=function(a){return c.call(this,a)||this};$jscomp.inherits(z,c);z.prototype.execute=function(){};d.Plugin=q})(jQuery,window,
document);
